# 筆記編輯器 Markdown 功能

## 功能說明
在筆記編輯器中添加了完整的 Markdown 功能，包括標題（H1-H6）、文字格式、列表、程式碼區塊、引用等常用語法。

## 修改的檔案

### `components/rich-text-editor.tsx`

## 新增的功能

### 1. 標題（H1-H6）
通過下拉選單選擇標題級別：
- **H1** - 最大標題
- **H2** - 次級標題
- **H3** - 三級標題
- **H4** - 四級標題
- **H5** - 五級標題
- **H6** - 六級標題
- **P** - 一般文字（取消標題格式）

### 2. 文字格式
- **粗體** (Ctrl+B) - 使文字加粗
- **斜體** (Ctrl+I) - 使文字傾斜
- **底線** (Ctrl+U) - 為文字添加底線
- **刪除線** - 為文字添加刪除線效果

### 3. 列表
- **無序列表** - 項目符號列表
- **有序列表** - 數字編號列表

### 4. 程式碼和引用
- **程式碼區塊** - 用於顯示程式碼
- **引用** - 用於引用文字

### 5. 其他
- **插入連結** - 添加超連結
- **分隔線** - 插入水平分隔線

## 工具列佈局

```
[標題▼] | [B] [I] [U] [S] | [•] [1.] | [</>] ["] | [🔗] [—]
```

### 分組說明
1. **標題** - 下拉選單，選擇 H1-H6 或一般文字
2. **文字格式** - 粗體、斜體、底線、刪除線
3. **列表** - 無序列表、有序列表
4. **程式碼和引用** - 程式碼區塊、引用
5. **其他** - 連結、分隔線

## 鍵盤快捷鍵

| 快捷鍵 | 功能 |
|--------|------|
| Ctrl+B (Mac: Cmd+B) | 粗體 |
| Ctrl+I (Mac: Cmd+I) | 斜體 |
| Ctrl+U (Mac: Cmd+U) | 底線 |

## 使用方式

### 1. 選擇標題
1. 點擊工具列左側的"標題"按鈕
2. 從下拉選單中選擇標題級別（H1-H6）
3. 輸入標題文字

### 2. 文字格式
1. 選中要格式化的文字
2. 點擊對應的格式按鈕（粗體、斜體等）
3. 或使用鍵盤快捷鍵

### 3. 插入列表
1. 點擊無序列表或有序列表按鈕
2. 輸入列表項目
3. 按 Enter 鍵新增下一個項目

### 4. 插入程式碼區塊
1. 點擊程式碼區塊按鈕 `</>`
2. 輸入程式碼
3. 再次點擊按鈕或選擇"一般文字"退出程式碼模式

### 5. 插入引用
1. 點擊引用按鈕 `"`
2. 輸入引用文字
3. 再次點擊按鈕或選擇"一般文字"退出引用模式

### 6. 插入連結
1. 選中要添加連結的文字
2. 點擊連結按鈕 `🔗`
3. 在彈出的對話框中輸入網址
4. 點擊確定

### 7. 插入分隔線
1. 點擊分隔線按鈕 `—`
2. 自動插入水平分隔線

## 技術實作

### 使用的 API
使用瀏覽器原生的 `document.execCommand` API：

```typescript
const execCommand = (command: string, value?: string) => {
  document.execCommand(command, false, value)
  editorRef.current?.focus()
  handleInput()
}
```

### 支援的命令
- `formatBlock` - 設定區塊格式（h1-h6, p, pre, blockquote）
- `bold` - 粗體
- `italic` - 斜體
- `underline` - 底線
- `strikeThrough` - 刪除線
- `insertUnorderedList` - 無序列表
- `insertOrderedList` - 有序列表
- `createLink` - 插入連結
- `insertHorizontalRule` - 插入分隔線

### 新增的圖標
使用 `lucide-react` 圖標庫：
- `Heading1`, `Heading2`, `Heading3` - 標題圖標
- `Code` - 程式碼圖標
- `Quote` - 引用圖標
- `Minus` - 分隔線圖標

### 下拉選單組件
使用 `@/components/ui/dropdown-menu` 組件：
```typescript
<DropdownMenu>
  <DropdownMenuTrigger asChild>
    <Button>標題</Button>
  </DropdownMenuTrigger>
  <DropdownMenuContent>
    <DropdownMenuItem onClick={() => execCommand("formatBlock", "h1")}>
      標題 1
    </DropdownMenuItem>
    {/* ... */}
  </DropdownMenuContent>
</DropdownMenu>
```

## 測試步驟

### 測試 1：標題功能
1. 創建新筆記
2. 點擊"標題"下拉選單
3. 選擇"標題 1"
4. 輸入文字
5. 確認文字顯示為大標題

**預期結果：**
- ✅ 文字以 H1 格式顯示
- ✅ 可以切換不同的標題級別
- ✅ 可以切換回一般文字

### 測試 2：文字格式
1. 輸入一段文字
2. 選中文字
3. 點擊粗體按鈕
4. 確認文字變粗

**預期結果：**
- ✅ 粗體、斜體、底線、刪除線都正常工作
- ✅ 可以組合使用（例如：粗體+斜體）
- ✅ 鍵盤快捷鍵正常工作

### 測試 3：列表
1. 點擊無序列表按鈕
2. 輸入第一個項目
3. 按 Enter 鍵
4. 輸入第二個項目

**預期結果：**
- ✅ 自動添加項目符號
- ✅ 按 Enter 鍵新增項目
- ✅ 有序列表自動編號

### 測試 4：程式碼區塊
1. 點擊程式碼區塊按鈕
2. 輸入程式碼
3. 確認顯示為程式碼格式

**預期結果：**
- ✅ 使用等寬字體
- ✅ 保留空格和換行
- ✅ 背景顏色不同

### 測試 5：引用
1. 點擊引用按鈕
2. 輸入引用文字
3. 確認顯示為引用格式

**預期結果：**
- ✅ 左側有引用線
- ✅ 文字縮排
- ✅ 樣式與一般文字不同

### 測試 6：連結
1. 輸入文字並選中
2. 點擊連結按鈕
3. 輸入網址
4. 確認文字變為連結

**預期結果：**
- ✅ 文字顯示為藍色
- ✅ 有底線
- ✅ 點擊可以開啟連結

### 測試 7：分隔線
1. 點擊分隔線按鈕
2. 確認插入水平線

**預期結果：**
- ✅ 顯示水平分隔線
- ✅ 可以在分隔線上下輸入文字

## 樣式效果

### 標題
```html
<h1>這是 H1 標題</h1>
<h2>這是 H2 標題</h2>
<h3>這是 H3 標題</h3>
```

### 文字格式
```html
<strong>粗體文字</strong>
<em>斜體文字</em>
<u>底線文字</u>
<strike>刪除線文字</strike>
```

### 列表
```html
<ul>
  <li>項目 1</li>
  <li>項目 2</li>
</ul>

<ol>
  <li>項目 1</li>
  <li>項目 2</li>
</ol>
```

### 程式碼和引用
```html
<pre>程式碼區塊</pre>
<blockquote>引用文字</blockquote>
```

### 連結和分隔線
```html
<a href="https://example.com">連結文字</a>
<hr>
```

## 優點

### 1. 豐富的格式選項
- 支援多種文字格式
- 支援標題、列表、程式碼等結構化內容
- 滿足各種筆記需求

### 2. 易於使用
- 直觀的工具列介面
- 清楚的圖標和提示
- 支援鍵盤快捷鍵

### 3. 即時預覽
- 所見即所得（WYSIWYG）
- 立即看到格式效果
- 無需切換預覽模式

### 4. 標準 HTML 輸出
- 使用標準 HTML 標籤
- 易於儲存和顯示
- 與現有系統兼容

## 注意事項

### 1. 瀏覽器兼容性
- `document.execCommand` 在現代瀏覽器中支援良好
- 部分舊版瀏覽器可能不支援某些功能

### 2. 內容清理
- 從其他地方複製貼上的內容可能包含額外的格式
- 建議添加"清除格式"功能

### 3. 行動裝置
- 工具列在小螢幕上可能需要滾動
- 已使用 `flex-wrap` 確保按鈕換行顯示

## 未來改進建議

1. **清除格式按鈕**
   - 移除所有格式，恢復純文字

2. **文字顏色和背景色**
   - 支援自訂文字顏色
   - 支援文字背景色（螢光筆效果）

3. **對齊方式**
   - 左對齊、置中、右對齊、兩端對齊

4. **插入圖片**
   - 支援從本地上傳圖片
   - 支援從網址插入圖片

5. **表格**
   - 插入和編輯表格

6. **撤銷/重做**
   - 支援 Ctrl+Z 撤銷
   - 支援 Ctrl+Y 重做

7. **Markdown 模式**
   - 提供 Markdown 語法輸入模式
   - 自動轉換為 HTML

8. **全螢幕模式**
   - 提供專注寫作的全螢幕模式

## 相關文件
- [ai-summary-add-to-note.md](./ai-summary-add-to-note.md) - AI 摘要添加至筆記功能
- [delete-category-cascade.md](./delete-category-cascade.md) - 刪除分類級聯功能
