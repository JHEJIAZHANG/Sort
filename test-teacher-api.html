<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¬è©¦æ•™å¸« API</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        .section {
            margin: 20px 0;
            padding: 15px;
            background: #252526;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #0e639c;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background: #1177bb;
        }
        pre {
            background: #1e1e1e;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
        .info { color: #569cd6; }
    </style>
</head>
<body>
    <h1>ğŸ§ª æ•™å¸« API æ¸¬è©¦å·¥å…·</h1>
    
    <div class="section">
        <h2>è¨­å®š</h2>
        <label>LINE User ID: </label>
        <input type="text" id="lineUserId" value="Uc8858c883da4bd4aecf9271aaa019a45" style="width: 400px; padding: 5px;">
    </div>

    <div class="section">
        <h2>æ¸¬è©¦ API</h2>
        <button onclick="testTeacherCourses()">æ¸¬è©¦æ•™å¸«èª²ç¨‹ API</button>
        <button onclick="testTeacherAssignments()">æ¸¬è©¦æ•™å¸«ä½œæ¥­ API</button>
        <button onclick="testBothAPIs()">æ¸¬è©¦å…©å€‹ API</button>
    </div>

    <div class="section">
        <h2>çµæœ</h2>
        <div id="results"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            results.innerHTML += `<div class="${className}">${message}</div>`;
        }

        function logJSON(label, data) {
            const results = document.getElementById('results');
            results.innerHTML += `<div class="info">${label}:</div><pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testTeacherCourses() {
            clearResults();
            const lineUserId = document.getElementById('lineUserId').value;
            
            log('========== æ¸¬è©¦æ•™å¸«èª²ç¨‹ API ==========', 'info');
            log(`LINE User ID: ${lineUserId}`, 'info');
            
            const url = `/api/courses/?line_user_id=${lineUserId}&_ts=${Date.now()}`;
            log(`è«‹æ±‚ URL: ${url}`, 'info');
            
            try {
                log('â³ ç™¼é€è«‹æ±‚...', 'info');
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'ngrok-skip-browser-warning': 'true'
                    },
                    credentials: 'include'
                });
                
                log(`âœ… ç‹€æ…‹ç¢¼: ${response.status}`, response.ok ? 'success' : 'error');
                
                const data = await response.json();
                logJSON('å›æ‡‰æ•¸æ“š', data);
                
                if (data.courses) {
                    log(`âœ… èª²ç¨‹æ•¸é‡: ${data.courses.length}`, 'success');
                    if (data.courses.length > 0) {
                        logJSON('ç¬¬ä¸€å€‹èª²ç¨‹', data.courses[0]);
                    }
                } else {
                    log('âŒ æ²’æœ‰æ‰¾åˆ° courses æ¬„ä½', 'error');
                }
                
            } catch (error) {
                log(`âŒ éŒ¯èª¤: ${error.message}`, 'error');
                console.error(error);
            }
        }

        async function testTeacherAssignments() {
            clearResults();
            const lineUserId = document.getElementById('lineUserId').value;
            
            log('========== æ¸¬è©¦æ•™å¸«ä½œæ¥­ API ==========', 'info');
            log(`LINE User ID: ${lineUserId}`, 'info');
            
            const url = `/api/teacher/assignments/?line_user_id=${lineUserId}&_ts=${Date.now()}`;
            log(`è«‹æ±‚ URL: ${url}`, 'info');
            
            try {
                log('â³ ç™¼é€è«‹æ±‚...', 'info');
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'ngrok-skip-browser-warning': 'true'
                    },
                    credentials: 'include'
                });
                
                log(`âœ… ç‹€æ…‹ç¢¼: ${response.status}`, response.ok ? 'success' : 'error');
                
                const data = await response.json();
                logJSON('å›æ‡‰æ•¸æ“š', data);
                
                if (data.data && data.data.all_assignments) {
                    log(`âœ… ä½œæ¥­æ•¸é‡: ${data.data.all_assignments.length}`, 'success');
                    if (data.data.all_assignments.length > 0) {
                        logJSON('ç¬¬ä¸€å€‹ä½œæ¥­', data.data.all_assignments[0]);
                    }
                } else {
                    log('âŒ æ²’æœ‰æ‰¾åˆ° data.all_assignments æ¬„ä½', 'error');
                }
                
            } catch (error) {
                log(`âŒ éŒ¯èª¤: ${error.message}`, 'error');
                console.error(error);
            }
        }

        async function testBothAPIs() {
            await testTeacherCourses();
            log('\n\n', 'info');
            await testTeacherAssignments();
        }
    </script>
</body>
</html>
